# WooCommerce Development Cursor Rules

You are an expert WooCommerce developer. Follow these rules when developing WooCommerce customizations.

## Core Principles

1. **Never Modify Core**: Always use hooks and filters, never edit WooCommerce files
2. **Template Overrides**: Copy templates to theme/woocommerce/ for customization
3. **Compatibility**: Ensure customizations work with WooCommerce updates
4. **Security**: Validate, sanitize, and escape all data
5. **Testing**: Test complete purchase flow after any changes
6. **Mobile First**: Ensure mobile-friendly checkout and product pages

## WooCommerce Support

Add WooCommerce support in theme:
```php
add_theme_support( 'woocommerce' );
add_theme_support( 'wc-product-gallery-zoom' );
add_theme_support( 'wc-product-gallery-lightbox' );
add_theme_support( 'wc-product-gallery-slider' );
```

## Template Overrides

To override WooCommerce templates:
- Copy from plugins/woocommerce/templates/ to theme/woocommerce/
- Maintain template structure
- Test after WooCommerce updates
- Keep overrides minimal (only what you need)

## Product Operations

Use WooCommerce product functions:
- `wc_get_product($id)` to get product object
- Use product methods: get_name(), get_price(), get_stock_status()
- Check product type: is_type('simple'), is_type('variable')
- Always verify product exists before operations

## Cart Operations

Use WooCommerce cart functions:
- `WC()->cart->add_to_cart()` for adding items
- `WC()->cart->get_cart()` for cart contents
- `WC()->cart->get_cart_total()` for totals
- Never manipulate cart directly, use WooCommerce methods

## Order Operations

Use WooCommerce order functions:
- `wc_get_order($order_id)` to get order object
- Use order methods: get_total(), get_billing_email(), get_items()
- Update status: `$order->update_status('completed')`
- Add notes: `$order->add_order_note()`

## Hooks and Filters

### Product Page Hooks
- `woocommerce_before_single_product`
- `woocommerce_single_product_summary` (priority matters)
- `woocommerce_after_single_product_summary`
- `woocommerce_product_tabs` (modify tabs)

### Shop/Archive Hooks
- `woocommerce_before_shop_loop`
- `woocommerce_after_shop_loop`
- `loop_shop_per_page` (change products per page)
- `loop_shop_columns` (change columns)

### Cart Hooks
- `woocommerce_before_cart`
- `woocommerce_cart_contents`
- `woocommerce_cart_totals`
- `woocommerce_add_to_cart_validation`

### Checkout Hooks
- `woocommerce_before_checkout_form`
- `woocommerce_checkout_fields` (modify fields)
- `woocommerce_checkout_process` (validate fields)
- `woocommerce_checkout_update_order_meta` (save custom data)
- `woocommerce_thankyou` (order received page)

## Custom Checkout Fields

When adding custom fields:
```php
// Add field
add_filter('woocommerce_checkout_fields', 'add_custom_field');

// Validate field
add_action('woocommerce_checkout_process', 'validate_custom_field');

// Save field
add_action('woocommerce_checkout_update_order_meta', 'save_custom_field');

// Display in admin
add_action('woocommerce_admin_order_data_after_billing_address', 'display_custom_field');
```

Always:
- Sanitize input: sanitize_text_field()
- Escape output: esc_html()
- Validate required fields
- Provide clear error messages

## Payment Gateways

When creating custom payment gateways:
- Extend `WC_Payment_Gateway` class
- Implement required methods: `process_payment()`
- Add settings form with `init_form_fields()`
- Handle IPN/webhook notifications
- Update order status appropriately
- Add order notes for tracking
- Test thoroughly with test mode

## Email Notifications

For custom emails:
- Extend `WC_Email` class
- Define trigger action
- Create email templates in theme/woocommerce/emails/
- Register email with `woocommerce_email_classes` filter
- Test all scenarios

## Security

### Always:
- Check if WooCommerce is active before using functions
- Verify nonces for forms
- Check user capabilities
- Sanitize all input
- Escape all output
- Validate data types

### Never:
- Trust user input
- Skip nonce verification
- Expose sensitive payment data
- Hardcode credentials
- Modify core files

## Product Queries

Use WC_Product_Query:
```php
$query = new WC_Product_Query(array(
    'limit' => 10,
    'status' => 'publish',
    'type' => 'simple',
));
$products = $query->get_products();
```

Always check if products exist before using them.

## Variable Products

When working with variations:
- Get variations with `$product->get_available_variations()`
- Check if product is variable: `$product->is_type('variable')`
- Get variation object: `wc_get_product($variation_id)`
- Handle variation attributes properly

## Stock Management

- Check stock: `$product->is_in_stock()`
- Get quantity: `$product->get_stock_quantity()`
- Update stock: `wc_update_product_stock($product, $quantity)`
- Handle backorders properly

## Pricing

- Get price: `$product->get_price()`
- Get regular price: `$product->get_regular_price()`
- Get sale price: `$product->get_sale_price()`
- Format price: `wc_price($price)`
- Calculate tax: use WooCommerce tax functions

## Customer Data

- Get current customer: `WC()->customer`
- Get billing data: `$order->get_billing_first_name()`, etc.
- Get shipping data: `$order->get_shipping_address_1()`, etc.
- Respect privacy laws (GDPR)

## Performance

- Cache product queries with transients
- Optimize database queries
- Minimize cart calculations
- Use object caching when available
- Lazy load images
- Minimize checkout page scripts

## Compatibility

Check for WooCommerce before using:
```php
if ( class_exists( 'WooCommerce' ) ) {
    // WooCommerce functionality
}
```

Check version if needed:
```php
if ( version_compare( WC_VERSION, '7.0', '>=' ) ) {
    // Version-specific code
}
```

## Testing

### Test These Flows:
1. Product browsing and filtering
2. Add to cart functionality
3. Cart updates and removals
4. Checkout process (all fields)
5. Payment processing
6. Order confirmation
7. Email notifications
8. Order management (admin)
9. Customer account area
10. Mobile experience

### Test With:
- Different product types
- Different payment methods
- Guest and registered users
- Various user roles
- Multiple shipping methods
- Tax calculations
- Coupon codes

## DO NOT

- Don't modify WooCommerce core files
- Don't override all templates (only what you need)
- Don't skip checkout testing
- Don't forget mobile testing
- Don't ignore tax implications
- Don't break the checkout flow
- Don't expose customer data
- Don't skip validation
- Don't hardcode payment credentials
- Don't forget about performance

## REST API

When using WooCommerce REST API:
- Authenticate properly (OAuth or API keys)
- Use appropriate endpoints
- Handle rate limiting
- Validate responses
- Handle errors gracefully
- Follow API versioning

## Webhooks

When implementing webhooks:
- Verify webhook signature
- Process asynchronously if possible
- Handle failures gracefully
- Log webhook activity
- Test thoroughly

## Subscriptions

If working with WooCommerce Subscriptions:
- Check if Subscriptions is active
- Use subscription-specific hooks
- Handle renewal payments
- Manage subscription status
- Test all renewal scenarios

## Reporting

When creating custom reports:
- Use WooCommerce data classes
- Optimize queries for large datasets
- Cache expensive calculations
- Provide date range filters
- Export functionality if needed

## Documentation

- Document custom hooks for extensibility
- Provide clear setup instructions
- Include troubleshooting guide
- List requirements and dependencies
- Document any third-party integrations

When generating WooCommerce code, always prioritize:
1. Security (payment data protection)
2. Compatibility (with WooCommerce updates)
3. Testing (complete purchase flow)
4. Mobile experience
5. Performance

Never make changes without thoroughly testing the complete purchase flow from product page through checkout to order confirmation.

